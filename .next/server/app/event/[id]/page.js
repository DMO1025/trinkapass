(()=>{var e={};e.id=697,e.ids=[697],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3662:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(82614).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},24169:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>I});var s=t(60687),r=t(43210);t(47748);var o=t(30474),n=t(87482),i=t(82614);let d=(0,i.A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);var c=t(27605),l=t(63442),m=t(45880),p=t(29867),u=t(3662);let f=(0,i.A)("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);var h=t(99196),b=t(11516);let x=(0,i.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),g=(0,i.A)("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);var v=t(35265),y=t(29596),j=t(6475);let _=(0,j.createServerReference)("40d6d60906e28ac35329caa00692e7faf88598a8ab",j.callServer,void 0,j.findSourceMapURL,"initiatePurchaseAction"),N=(0,j.createServerReference)("60adfb1d624e76ca872defe5f78c8372b129fbe0bf",j.callServer,void 0,j.findSourceMapURL,"checkPaymentStatusAction");var P=t(66420),w=t(34729);let k=m.Ik({nome_comprador:m.Yj().min(3,{message:"Nome completo \xe9 obrigat\xf3rio e deve ter pelo menos 3 caracteres."}),email_comprador:m.Yj().email({message:"E-mail inv\xe1lido."}),whatsapp:m.Yj().regex(/^\d{10,11}$/,{message:"WhatsApp inv\xe1lido. Use apenas n\xfameros (Ex: 11988887777)."}),quantidade:m.ai().min(1,{message:"Selecione pelo menos 1 ingresso."}).max(5,{message:"M\xe1ximo de 5 ingressos por compra."})});function C({event:e,onModalClose:a}){let{toast:t}=(0,p.dj)(),[n,i]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),[j,C]=(0,r.useState)(!1),[I,A]=(0,r.useState)(null),[S,$]=(0,r.useState)(null),[E,M]=(0,r.useState)(null),[q,R]=(0,r.useState)(0),[T,z]=(0,r.useState)(null),[O,F]=(0,r.useState)(null),[X,D]=(0,r.useState)(!1),[G,V]=(0,r.useState)(5),L=(0,r.useMemo)(()=>`trinkapass_pending_purchase_${e?.id}`,[e?.id]),B=(0,c.mN)({resolver:(0,l.u)(k),defaultValues:{nome_comprador:"",email_comprador:"",whatsapp:"",quantidade:1}}),{register:W,handleSubmit:K,watch:U,setValue:Q,formState:{errors:H},reset:Z,getValues:Y}=B,J=U("quantidade"),ee=(0,r.useMemo)(()=>e.preco_ingresso*J,[e.preco_ingresso,J]),ea=(0,r.useMemo)(()=>P.E*J,[J]),et=(0,r.useMemo)(()=>ee+ea,[ee,ea]),es=async a=>{if(0===a.quantidade&&G>0){t({title:"Quantidade Inv\xe1lida",description:"Selecione pelo menos 1 ingresso.",variant:"destructive"});return}if(0===a.quantidade&&0===G){t({title:"Ingressos Esgotados",description:"N\xe3o h\xe1 ingressos dispon\xedveis para este evento.",variant:"destructive"});return}i(!0),D(!1);let s=await _({evento_id:e.id,...a});if(s.success&&s.pixCopyPaste&&s.saleId&&s.totalAmount&&s.mpPaymentId&&s.mpExternalReference){A(s.pixCopyPaste),$(s.qrCodeBase64||null),M(s.saleId),R(s.totalAmount),z(s.mpPaymentId),F(s.mpExternalReference),C(!0);let a={eventId:e.id,pixCopyPaste:s.pixCopyPaste,qrCodeBase64:s.qrCodeBase64||null,saleId:s.saleId,totalAmount:s.totalAmount,mpPaymentId:s.mpPaymentId,mpExternalReference:s.mpExternalReference,formValues:Y()};localStorage.setItem(L,JSON.stringify(a)),t({title:"PIX Gerado com Sucesso!",description:"Copie o c\xf3digo PIX ou escaneie o QR Code para finalizar. A confirma\xe7\xe3o ser\xe1 autom\xe1tica.",variant:"default",duration:8e3})}else t({title:"Erro ao Iniciar Compra",description:s.error||"N\xe3o foi poss\xedvel gerar os detalhes de pagamento. Tente novamente.",variant:"destructive"});i(!1)},er=async()=>{if(I)try{await navigator.clipboard.writeText(I),t({title:"C\xf3digo PIX Copiado!",description:"O c\xf3digo PIX foi copiado para a \xe1rea de transfer\xeancia.",variant:"default"})}catch(e){console.error("Failed to copy PIX code: ",e),t({title:"Erro ao Copiar",description:"N\xe3o foi poss\xedvel copiar o c\xf3digo PIX. Tente manualmente.",variant:"destructive"})}},eo=async()=>{if(!T){t({title:"Erro",description:"ID de pagamento n\xe3o encontrado para verifica\xe7\xe3o.",variant:"destructive"});return}m(!0);let e=await N(T,O||void 0);if(m(!1),e.success&&"approved"===e.paymentStatus){if(D(!0),localStorage.removeItem(L),e.organizerWhatsAppNumber&&e.prefilledWhatsAppMessageToOrganizer){let a=`https://wa.me/${e.organizerWhatsAppNumber}?text=${encodeURIComponent(e.prefilledWhatsAppMessageToOrganizer)}`;window.open(a,"_blank"),t({title:"Pagamento Confirmado!",description:e.message+" Voc\xea ser\xe1 redirecionado para o WhatsApp para informar o organizador.",variant:"default",duration:1e4})}else t({title:"Pagamento Aprovado!",description:e.message,variant:"default"});a&&a()}else t({title:e.success?"Status do Pagamento":"Erro ao Verificar Status",description:e.message,variant:e.success?"default":"destructive"})},en=(t=!0)=>{C(!1),A(null),$(null),M(null),z(null),F(null),D(!1),i(!1),B.reset({nome_comprador:"",email_comprador:"",whatsapp:"",quantidade:+(G>0)}),t&&e?.id&&localStorage.removeItem(L),a&&a()},ei=e=>{let a=J+e;a>=1&&a<=G&&Q("quantidade",a,{shouldValidate:!0})};return j&&I?(0,s.jsx)("div",{className:"card border-0",children:(0,s.jsx)("div",{className:"card-body p-0",children:X?(0,s.jsxs)("div",{className:"text-center p-3 bg-success-subtle border border-success rounded-3",children:[(0,s.jsx)(u.A,{className:"h-16 w-16 text-success mx-auto mb-3"}),(0,s.jsx)("p",{className:"fs-5 fw-semibold text-success",children:"Seu pagamento foi aprovado!"}),(0,s.jsx)("p",{className:"small text-success-emphasis",children:"A confirma\xe7\xe3o foi processada. Seus ingressos est\xe3o garantidos! Se aplic\xe1vel, voc\xea foi redirecionado para notificar o organizador via WhatsApp."}),(0,s.jsx)("button",{onClick:()=>en(!0),className:"btn btn-primary w-100 mt-3",children:"Comprar Mais Ingressos (Fechar)"})]}):(0,s.jsxs)("div",{className:"vstack gap-4",children:[S?(0,s.jsx)("div",{className:"d-flex justify-content-center p-3 bg-light rounded-3",children:(0,s.jsx)(o.default,{src:`data:image/png;base64,${S}`,alt:`QR Code para ${e.nome_evento}`,width:200,height:200,className:"rounded","data-ai-hint":"payment QR code"})}):(0,s.jsx)("div",{className:"d-flex justify-content-center p-3 bg-light rounded-3 position-relative",style:{height:"200px"},children:(0,s.jsx)(o.default,{src:e.imagem_url||`https://picsum.photos/seed/${e.id}/400/200`,alt:`Imagem ${e.nome_evento}`,layout:"fill",objectFit:"cover",className:"rounded","data-ai-hint":"event image banner"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"pixCode",className:"form-label small text-muted",children:"PIX Copia e Cola (Mercado Pago):"}),(0,s.jsxs)("div",{className:"input-group",children:[(0,s.jsx)(w.T,{id:"pixCode",readOnly:!0,value:I,className:"form-control form-control-sm small bg-light",rows:3,style:{resize:"none"}}),(0,s.jsx)("button",{className:"btn btn-secondary",type:"button",onClick:er,"aria-label":"Copiar c\xf3digo PIX",children:(0,s.jsx)(f,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("p",{className:"text-center fw-semibold fs-5 text-dark",children:["Valor Total: R$ ",q.toFixed(2).replace(".",",")]}),(0,s.jsxs)("div",{className:"alert alert-info small d-flex align-items-start gap-2",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 flex-shrink-0 mt-1"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{className:"d-block",children:"Aguardando Pagamento"}),(0,s.jsx)("p",{className:"mb-1",children:"Ap\xf3s efetuar o pagamento PIX, a confirma\xe7\xe3o ser\xe1 processada automaticamente pelo nosso sistema (via webhook). Voc\xea pode usar o bot\xe3o abaixo para uma verifica\xe7\xe3o manual."}),(0,s.jsx)("p",{className:"mb-0",children:"Se voc\xea fechar esta p\xe1gina, pode acompanhar o status da sua compra atrav\xe9s do seu e-mail ou contato com o organizador caso tenha problemas."})]})]}),(0,s.jsxs)("button",{onClick:eo,className:"btn btn-secondary w-100 d-flex align-items-center justify-content-center gap-2",disabled:d,children:[d?(0,s.jsx)(b.A,{className:"me-2 h-4 w-4 animate-spin"}):(0,s.jsx)(x,{className:"me-2 h-4 w-4"}),"Verificar Status"]}),(0,s.jsx)("button",{onClick:()=>en(!0),className:"btn btn-dark w-100 text-white",disabled:n||d,children:"Voltar e Alterar Dados (Cancela este PIX)"})]})})}):(0,s.jsx)("div",{className:"card border-0",children:(0,s.jsx)("div",{className:"card-body p-0",children:(0,s.jsxs)("form",{onSubmit:K(es),className:"needs-validation",noValidate:!0,children:[(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{htmlFor:"nome_comprador",className:"form-label fw-medium",children:"Nome Completo"}),(0,s.jsx)("input",{id:"nome_comprador",...W("nome_comprador"),className:`form-control ${H.nome_comprador?"is-invalid":""}`}),H.nome_comprador&&(0,s.jsx)("div",{className:"invalid-feedback",children:H.nome_comprador.message})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{htmlFor:"email_comprador",className:"form-label fw-medium",children:"E-mail"}),(0,s.jsx)("input",{id:"email_comprador",type:"email",...W("email_comprador"),className:`form-control ${H.email_comprador?"is-invalid":""}`}),H.email_comprador&&(0,s.jsx)("div",{className:"invalid-feedback",children:H.email_comprador.message})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{htmlFor:"whatsapp",className:"form-label fw-medium",children:"WhatsApp (somente n\xfameros)"}),(0,s.jsx)("input",{id:"whatsapp",type:"tel",...W("whatsapp"),className:`form-control ${H.whatsapp?"is-invalid":""}`,placeholder:"Ex: 11988887777"}),H.whatsapp&&(0,s.jsx)("div",{className:"invalid-feedback",children:H.whatsapp.message})]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("label",{htmlFor:"quantidade",className:"form-label fw-medium",children:"Quantidade de Ingressos"}),(0,s.jsxs)("div",{className:`d-flex align-items-center justify-content-center border rounded-2 p-2 ${0===G||H.quantidade?"border-danger":"border-input"}`,children:[(0,s.jsx)("button",{type:"button",onClick:()=>ei(-1),disabled:J<=1||0===G,className:"btn btn-outline-secondary btn-sm p-1","aria-label":"Diminuir quantidade",children:(0,s.jsx)(g,{size:20})}),(0,s.jsx)("input",{type:"text",id:"quantidade-display",value:0===G?"Esgotado":J,readOnly:!0,className:"form-control-plaintext text-center fw-bold mx-2",style:{width:"60px",appearance:"none",MozAppearance:"textfield"},"aria-live":"polite"}),(0,s.jsx)("button",{type:"button",onClick:()=>ei(1),disabled:J>=G||0===G,className:"btn btn-outline-secondary btn-sm p-1","aria-label":"Aumentar quantidade",children:(0,s.jsx)(v.A,{size:20})})]}),(0,s.jsx)("input",{type:"hidden",...W("quantidade",{valueAsNumber:!0})}),H.quantidade&&(0,s.jsx)("div",{className:"text-danger small mt-1",children:H.quantidade.message}),0===G&&!H.quantidade&&(0,s.jsx)("div",{className:"text-danger small mt-1",children:"N\xe3o h\xe1 ingressos dispon\xedveis."})]}),(0,s.jsxs)("div",{className:"text-end small text-muted pt-2",children:[(0,s.jsxs)("p",{className:"mb-0",children:["Ingressos: R$ ",ee.toFixed(2).replace(".",",")]}),(0,s.jsxs)("p",{className:"mb-0",children:["Taxa de Servi\xe7o: R$ ",ea.toFixed(2).replace(".",",")]})]}),(0,s.jsxs)("div",{className:"fs-5 fw-semibold text-end text-primary mb-3",children:["Total: R$ ",et.toFixed(2).replace(".",",")]}),(0,s.jsxs)("button",{type:"submit",className:"btn btn-accent w-100 btn-lg fw-semibold d-flex align-items-center justify-content-center gap-2",disabled:n||0===G||0===J,children:[n?(0,s.jsx)(b.A,{className:"me-2 h-5 w-5 animate-spin"}):(0,s.jsx)(y.A,{className:"me-2 h-5 w-5"}),"Gerar PIX para Pagamento"]})]})})})}function I({params:e}){(0,r.use)(e);let{toast:a}=(0,p.dj)(),[t,i]=(0,r.useState)(null),[c,l]=(0,r.useState)(!0),[m,u]=(0,r.useState)(null),[f,h]=(0,r.useState)(!1),[b,x]=(0,r.useState)(!1),[g,v]=(0,r.useState)(""),[y,j]=(0,r.useState)(""),[_,N]=(0,r.useState)(""),P=async(e,t)=>{try{await navigator.clipboard.writeText(e),a({title:"Link Copiado!",description:t||"O link do evento foi copiado para a \xe1rea de transfer\xeancia.",variant:"default"})}catch(e){a({title:"Erro ao Copiar Link",description:"N\xe3o foi poss\xedvel copiar o link do evento. Por favor, copie manualmente.",variant:"destructive"}),console.error("Error copying link to clipboard:",e)}},w=async()=>{if(!t)return;let e={title:t.nome_evento,text:`Confira este evento: ${t.nome_evento} - ${g} \xe0s ${y}. Saiba mais e compre ingressos!`,url:window.location.href};if(navigator.share&&"function"==typeof navigator.share)try{await navigator.share(e),a({title:"Evento Compartilhado!",description:"O link do evento foi compartilhado."})}catch(a){await P(e.url,"Compartilhamento nativo falhou. Link copiado!")}else await P(e.url,"Compartilhamento nativo n\xe3o dispon\xedvel. Link copiado!")};if(!b)return(0,s.jsx)("div",{className:"container text-center py-5",children:(0,s.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,s.jsx)("span",{className:"visually-hidden",children:"Carregando..."})})});if(c)return(0,s.jsxs)("div",{className:"container text-center py-5",children:[(0,s.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,s.jsx)("span",{className:"visually-hidden",children:"Carregando detalhes do evento..."})}),(0,s.jsx)("p",{className:"mt-2",children:"Carregando detalhes do evento..."})]});if(m)return(0,s.jsxs)("div",{className:"container text-center py-5",children:[(0,s.jsx)("h1",{className:"display-5 fw-bold text-danger",children:"Erro"}),(0,s.jsx)("p",{className:"text-muted mt-2",children:m})]});if(!t)return(0,s.jsxs)("div",{className:"container text-center py-5",children:[(0,s.jsx)("h1",{className:"display-5 fw-bold text-danger",children:"Evento n\xe3o encontrado"}),(0,s.jsx)("p",{className:"text-muted mt-2",children:"O evento que voc\xea est\xe1 procurando n\xe3o existe ou foi removido."})]});let k=t.quantidade_disponivel<=0;return(0,s.jsxs)("div",{className:"container-fluid container-lg py-4 py-md-5",children:[(0,s.jsxs)("div",{className:"card border",children:[(0,s.jsx)("div",{className:"card-body p-3 p-md-4",children:(0,s.jsxs)("div",{className:"row g-3 g-md-4",children:[(0,s.jsx)("div",{className:"col-md-4 col-lg-3",children:(0,s.jsx)("div",{className:"position-relative w-100",style:{aspectRatio:"3/4"},children:(0,s.jsx)(o.default,{src:t.imagem_url||`https://picsum.photos/seed/${t.id}/600/800`,alt:t.nome_evento,layout:"fill",objectFit:"cover",className:"rounded",priority:!0,"data-ai-hint":"event poster"})})}),(0,s.jsx)("div",{className:"col-md-8 col-lg-9",children:(0,s.jsxs)("div",{className:"d-flex flex-column h-100",children:[(0,s.jsxs)("div",{className:"position-relative",children:[(0,s.jsx)("button",{onClick:w,className:"btn btn-sm btn-link text-secondary p-0 position-absolute top-0 end-0","aria-label":"Compartilhar evento",title:"Compartilhar evento",children:(0,s.jsx)(n.A,{size:24})}),(0,s.jsxs)("h1",{className:"fs-2 fw-bold text-primary mb-1",children:[t.nome_evento," - ",y]}),(0,s.jsxs)("p",{className:"text-muted mb-2",children:[_.charAt(0).toUpperCase()+_.slice(1),", ",g]})]}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("p",{className:"fw-semibold text-dark mb-0",children:t.nome_local_evento||"Local a definir"}),(0,s.jsxs)("p",{className:"text-muted small",children:[t.local,", ",t.cidade," - ",t.cep]})]}),(0,s.jsxs)("div",{className:"mt-auto d-flex flex-column align-items-start align-items-md-end pt-3",children:[(0,s.jsxs)("div",{className:"mb-2 text-md-end",children:[(0,s.jsxs)("p",{className:"fs-5 fw-bold text-primary mb-0",children:["R$ ",t.preco_ingresso.toFixed(2).replace(".",",")]}),(0,s.jsx)("p",{className:"small text-muted",children:k?(0,s.jsx)("span",{className:"text-danger fw-semibold",children:"Esgotado"}):`${t.quantidade_disponivel} ingressos dispon\xedveis`})]}),k?(0,s.jsx)("button",{type:"button",className:"btn btn-danger btn-lg fw-semibold w-100 w-md-auto",disabled:!0,children:"Ingressos Esgotados"}):(0,s.jsxs)("button",{type:"button",className:"btn btn-accent btn-lg fw-semibold w-100 w-md-auto d-flex align-items-center justify-content-center gap-2",onClick:()=>h(!0),children:[(0,s.jsx)(d,{className:"h-5 w-5"})," Comprar"]})]})]})})]})}),t.descricao&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("hr",{className:"my-0"}),(0,s.jsxs)("div",{className:"card-body p-3 p-md-4",children:[(0,s.jsx)("h2",{className:"fs-4 fw-semibold text-dark mb-3",children:"Sobre o Evento"}),(0,s.jsx)("div",{className:"text-dark lh-lg",dangerouslySetInnerHTML:{__html:t.descricao.replace(/\n/g,"<br />")}})]})]})]}),f&&(0,s.jsx)("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},onClick:e=>{e.target===e.currentTarget&&h(!1)},children:(0,s.jsx)("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header bg-light",children:[(0,s.jsxs)("h5",{className:"modal-title text-primary d-flex align-items-center gap-2",children:[(0,s.jsx)(d,{className:"h-6 w-6"})," Comprar Ingresso - ",t.nome_evento]}),(0,s.jsx)("button",{type:"button",className:"btn-close",onClick:()=>h(!1),"aria-label":"Close"})]}),(0,s.jsx)("div",{className:"modal-body p-4",children:(0,s.jsx)(C,{event:t,onModalClose:()=>h(!1)})})]})})})]})}},29250:(e,a,t)=>{"use strict";t.r(a),t.d(a,{"000520d6b503719548fb6bef3dff8ec45fd4e804ce":()=>s.mt,"005c2d08406700dc152b1561ded4681ff83fdadb8d":()=>s.kQ,"00a276c7296ead0da9cfd04a214f18fcea9396a73a":()=>s.y7,"00bf65ed71343e251550082bbf0339fa8a22b7ed24":()=>s.lo,"00c601a634a1c9378df1c44cbefcc642150b349a53":()=>s.gA,"403b0232b3b40821faca75beb72aba1a04e1f84b11":()=>s.Ej,"4056ec7672903b2a8eb3bc0c5488ee94bd01e08212":()=>s.zl,"40746f192df6bfe2d0c69fea94ff420b4dd6b9b8bf":()=>s.kl,"4074b6739d0532ed98e51e2d88f2f053b4d71e55b9":()=>s.hc,"40aaa6cf6cf17e830e8f3551c28219a6121d545fb0":()=>s.Vf,"40c205b0e33dfc1c686685d22260288319ab1386f5":()=>s.nu,"40c6c144facbff83d8b53f3522874415284261c468":()=>s.Fg,"40cef2ed129f2e4ae69d23a580670158fca0857dda":()=>s.BG,"40d046635bbc6baa97a47dc766104ff4e21fb69efa":()=>s.ht,"40d6d60906e28ac35329caa00692e7faf88598a8ab":()=>l,"40d8847af7df11626312812a1afd1ab7a6f174c135":()=>s.Xx,"40f4c98a70820be41d1af3666a880afe9f9224a765":()=>s._q,"40f9a03f67f919322f175220a208bae7cfa1a12511":()=>s.Xr,"40fbac1940c300bb9f8ee5bad7d11cb575270bff5c":()=>s.Ng,"40fe749a8391e6528facea5a25513e9e6e91d9b012":()=>s.Z8,"60036980b5bafb358b05e2382ec6b2c82578bfdeab":()=>s.W2,"60adfb1d624e76ca872defe5f78c8372b129fbe0bf":()=>m,"60c7c4de1387c7d0761a4f5314fa34ef12c609fe19":()=>s.gt,"60ccfd18cb390812f69ba04b4a2c39d18cdfacd5f5":()=>s.zw,"60dd176c250848944b1a7f76f9e769d5429c45e57e":()=>s.TK,"707c48103324414711b8ea0a94e322b20645c22419":()=>s.OT,"70d0f99b7427409d8212b0fc9420f3a4673f1bb410":()=>s.ql,"70dc2fdf7817e715b7ada4867546bafb6f98e31730":()=>s.qM});var s=t(26222),r=t(91199);t(42087);var o=t(48077),n=t(33331);async function i(e,a,t,s){let r=(await (0,o.mt)()).mercadoPagoAccessToken||process.env.MERCADO_PAGO_ACCESS_TOKEN;if(!r)return console.error("Mercado Pago Access Token is not configured in settings or environment variables."),{success:!1,error:"Configura\xe7\xe3o de pagamento indispon\xedvel. Verifique as configura\xe7\xf5es do administrador."};let n=parseFloat(e.toFixed(2));try{let e=await fetch("https://api.mercadopago.com/v1/payments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,"X-Idempotency-Key":s},body:JSON.stringify({transaction_amount:n,description:a,payment_method_id:"pix",payer:{email:t},external_reference:s})}),o=await e.json();if(!e.ok){console.error("Mercado Pago API Error creating payment:",o);let a=o.message||`Erro ${e.status} ao criar pagamento PIX.`,t="Falha ao gerar PIX junto ao Mercado Pago.";if(o.cause&&Array.isArray(o.cause)&&o.cause.length>0){let e=o.cause[0];e.code&&e.description&&(e.description.includes("payer.email")||e.description.includes("external_reference"))&&(t=`Detalhe do erro: ${e.description}`)}else a.includes("transaction_amount")&&(t="Valor da transa\xe7\xe3o inv\xe1lido para o Mercado Pago.");return{success:!1,error:t}}let i=o.point_of_interaction?.transaction_data?.qr_code,d=o.point_of_interaction?.transaction_data?.qr_code_base64,c=o.id?.toString();if(!i)return console.error("Mercado Pago API did not return PIX copy/paste code:",o),{success:!1,error:"N\xe3o foi poss\xedvel obter o c\xf3digo PIX Copia e Cola do Mercado Pago."};return{success:!0,pixCopyPaste:i,qrCodeBase64:d,paymentId:c}}catch(e){return console.error("Network or other error creating Mercado Pago PIX payment:",e),{success:!1,error:"Erro de comunica\xe7\xe3o ao tentar gerar PIX. Tente novamente."}}}async function d(e){let a=(await (0,o.mt)()).mercadoPagoAccessToken||process.env.MERCADO_PAGO_ACCESS_TOKEN;if(!a)return console.error("Mercado Pago Access Token is not configured."),{success:!1,error:"Configura\xe7\xe3o de pagamento indispon\xedvel."};if(!e)return{success:!1,error:"ID do Pagamento Mercado Pago n\xe3o fornecido."};try{console.log(`Fetching payment status for MP Payment ID: ${e}`);let t=await fetch(`https://api.mercadopago.com/v1/payments/${e}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}}),s=await t.json();if(console.log(`MP API Response for ${e} status: ${t.status}`,s),!t.ok)return console.error(`Mercado Pago API Error fetching payment status for ID ${e}:`,s),{success:!1,error:s.message||`Erro ${t.status} ao buscar status do pagamento.`,paymentId:e};return{success:!0,status:s.status,paymentId:s.id?.toString(),externalReference:s.external_reference}}catch(a){return console.error(`Network or other error fetching Mercado Pago payment status for ID ${e}:`,a),{success:!1,error:"Erro de comunica\xe7\xe3o ao verificar status do pagamento.",paymentId:e}}}(0,n.D)([i,d]),(0,r.A)(i,"7893fb752961f9ed9f78446bf35e192686bb942611",null),(0,r.A)(d,"40235014cac3a325b9cc84badd86e6021a53186f3f",null);var c=t(7944);async function l(e){try{let a=await (0,s.Z8)(e.evento_id);if(!a)return{success:!1,error:"Evento n\xe3o encontrado."};if(a.quantidade_disponivel<e.quantidade)return{success:!1,error:"Ingressos insuficientes dispon\xedveis."};let t=a.next_sale_reference_number||1,r=a.id.startsWith("evt-")?a.id.substring(4,12):a.id.substring(0,8),o=`TRK-${r}-${String(t).padStart(9,"0")}`,n=a.preco_ingresso,d=n+2,c=d*e.quantidade,l=await i(c,`Ingressos para ${a.nome_evento} (TrinkaPass)`,e.email_comprador,o);if(!l.success||!l.pixCopyPaste||!l.paymentId)return{success:!1,error:l.error||"Falha ao gerar PIX com o Mercado Pago."};await (0,s.gt)(a.id,t+1)||console.error(`CRITICAL: Failed to update sale reference counter for event ${a.id} after MP PIX generation. Expected next: ${t+1}`);let m={evento_id:e.evento_id,nome_comprador:e.nome_comprador,email_comprador:e.email_comprador,whatsapp:e.whatsapp,quantidade:e.quantidade,preco_ingresso_unitario:n,taxa_servico_unitaria:2,valor_total_item:d,valor_total_compra:c,data_compra:new Date().toISOString(),status:"pending_payment",pix_copia_cola_mp:l.pixCopyPaste,mp_payment_id:l.paymentId,mercado_pago_external_reference:o},p=await (0,s.Vf)(m);return{success:!0,pixCopyPaste:l.pixCopyPaste,qrCodeBase64:l.qrCodeBase64,saleId:p.id,totalAmount:c,mpPaymentId:l.paymentId,mpExternalReference:o}}catch(a){console.error("Error initiating purchase:",a);let e="Ocorreu um erro ao iniciar sua compra.";return a instanceof Error&&(e=a.message),{success:!1,error:e}}}async function m(e,a){if(!e)return{success:!1,message:"ID do Pagamento do Mercado Pago n\xe3o fornecido."};try{let t,r;let o=await d(e);if(!o.success||!o.status)return{success:!1,message:o.error||"Falha ao verificar status do pagamento com Mercado Pago.",mpPaymentId:e,saleId:a||o.externalReference};let n=`Status do Pagamento: ${o.status}`,i=o.externalReference||a;if("approved"===o.status&&i){let e=await (0,s.zl)(i);if(e){if("pending_payment"===e.status){console.log(`checkPaymentStatusAction: Confirming sale ${e.id} (MP Ext Ref: ${i}) based on MP status 'approved'. Current DB status: '${e.status}'.`);let a=await (0,s.zw)(e.id,{status:"paid",data_pagamento_confirmado:new Date().toISOString(),mp_payment_id:o.paymentId});a?(console.log(`checkPaymentStatusAction: Sale ${a.id} status updated to 'paid'. Updating stock.`),await (0,s.OT)(a.evento_id,a.quantidade)?console.log(`checkPaymentStatusAction: Stock for event ${a.evento_id} updated.`):console.error(`checkPaymentStatusAction: CRITICAL - Failed to update stock for event ${a.evento_id} after sale ${a.id} confirmation.`),(0,c.revalidatePath)("/"),(0,c.revalidatePath)(`/event/${a.evento_id}`),(0,c.revalidatePath)("/admin/dashboard"),(0,c.revalidatePath)(`/admin/events/${a.evento_id}/buyers`),(0,c.revalidatePath)("/organizer/dashboard"),(0,c.revalidatePath)(`/organizer/events/${a.evento_id}/buyers`),console.log(`checkPaymentStatusAction: Paths revalidated for sale ${a.id}.`)):console.error(`checkPaymentStatusAction: Failed to update sale ${e.id} in DB.`)}else console.log(`checkPaymentStatusAction: Sale ${e.id} (MP Ext Ref: ${i}) is already in status '${e.status}'. No DB update needed by manual check.`);let a=await (0,s.Z8)(e.evento_id);if(a&&a.organizer_id){let o=await (0,s.kl)(a.organizer_id);o&&o.whatsapp&&(t=`55${o.whatsapp.replace(/\D/g,"")}`,r=`Ol\xe1 ${o.nome||"Organizador(a)"},
Uma compra de ${e.quantidade} ingresso(s) para o seu evento "${a.nome_evento}" (TrinkaPass) foi APROVADA!
Refer\xeancia da Compra (Mercado Pago): ${i}.
ID da Venda (TrinkaPass): ${e.id}.
Valor total da compra: R$ ${e.valor_total_compra.toFixed(2).replace(".",",")}.
Nome do Comprador: ${e.nome_comprador}.
Obrigado(a)!`)}}else console.warn(`checkPaymentStatusAction: Sale with MP External Reference ${i} not found, but MP API reported 'approved'.`);n="Pagamento Aprovado!"}else switch(o.status){case"pending_payment":case"in_process":case"pending":n="Pagamento ainda est\xe1 pendente ou em processamento.";break;case"rejected":n="Pagamento Rejeitado.";break;case"cancelled":n="Pagamento Cancelado.";break;case"refunded":n="Pagamento Estornado.";break;case"charged_back":n="Pagamento Revertido (Chargeback).";break;default:n=`Status do pagamento: ${o.status||"Desconhecido"}. Aguarde a confirma\xe7\xe3o.`}return{success:!0,paymentStatus:o.status,message:n,saleId:i,mpPaymentId:o.paymentId,organizerWhatsAppNumber:t,prefilledWhatsAppMessageToOrganizer:r}}catch(t){return console.error(`Error in checkPaymentStatusAction for MP Payment ID ${e}:`,t),{success:!1,message:"Ocorreu um erro interno ao verificar o status do pagamento.",mpPaymentId:e,saleId:a}}}(0,n.D)([l,m]),(0,r.A)(l,"40d6d60906e28ac35329caa00692e7faf88598a8ab",null),(0,r.A)(m,"60adfb1d624e76ca872defe5f78c8372b129fbe0bf",null)},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30474:(e,a,t)=>{"use strict";t.d(a,{default:()=>r.a});var s=t(31261),r=t.n(s)},30865:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"E:\\\\xampp\\\\htdocs\\\\GIT\\\\trinkapasss\\\\src\\\\app\\\\event\\\\[id]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"E:\\xampp\\htdocs\\GIT\\trinkapasss\\src\\app\\event\\[id]\\page.tsx","default")},31261:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),!function(e,a){for(var t in a)Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}(a,{default:function(){return d},getImageProps:function(){return i}});let s=t(14985),r=t(44953),o=t(46533),n=s._(t(1933));function i(e){let{props:a}=(0,r.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!0,unoptimized:!1}});for(let[e,t]of Object.entries(a))void 0===t&&delete a[e];return{props:a}}let d=o.Image},33873:e=>{"use strict";e.exports=require("path")},34729:(e,a,t)=>{"use strict";t.d(a,{T:()=>n});var s=t(60687),r=t(43210),o=t(4780);let n=r.forwardRef(({className:e,...a},t)=>(0,s.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...a}));n.displayName="Textarea"},35265:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(82614).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},45370:(e,a,t)=>{Promise.resolve().then(t.bind(t,24169))},47748:(e,a,t)=>{"use strict";t.d(a,{Z:()=>r});var s=t(6475);let r=(0,s.createServerReference)("40fe749a8391e6528facea5a25513e9e6e91d9b012",s.callServer,void 0,s.findSourceMapURL,"getEventById")},48077:(e,a,t)=>{"use strict";t.d(a,{Fg:()=>s.Fg,Ng:()=>s.Ng,TK:()=>s.TK,Xx:()=>s.Xx,kl:()=>s.kl,mt:()=>s.mt,ql:()=>s.ql});var s=t(26222)},48705:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>l,routeModule:()=>p,tree:()=>c});var s=t(65239),r=t(48088),o=t(88170),n=t.n(o),i=t(30893),d={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);t.d(a,d);let c={children:["",{children:["event",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,30865)),"E:\\xampp\\htdocs\\GIT\\trinkapasss\\src\\app\\event\\[id]\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,21075)),"E:\\xampp\\htdocs\\GIT\\trinkapasss\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,l=["E:\\xampp\\htdocs\\GIT\\trinkapasss\\src\\app\\event\\[id]\\page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/event/[id]/page",pathname:"/event/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66420:(e,a,t)=>{"use strict";t.d(a,{E:()=>s});let s=2},79551:e=>{"use strict";e.exports=require("url")},79748:e=>{"use strict";e.exports=require("fs/promises")},87482:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(82614).A)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]])},98514:(e,a,t)=>{Promise.resolve().then(t.bind(t,30865))}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[447,724,20,658,543,105,533,944,507,989],()=>t(48705));module.exports=s})();