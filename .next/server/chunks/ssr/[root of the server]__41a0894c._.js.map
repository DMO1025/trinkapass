{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/data-service.ts"],"sourcesContent":["// src/lib/data-service.ts\n'use server';\n\nimport fs from 'fs/promises';\nimport path from 'path';\nimport type { EventData, SaleData, NewSaleDataInternal, UserData, EventCreationData, SettingsData } from './types';\nimport { v4 as uuidv4 } from 'uuid'; \n\nconst dataDir = path.join(process.cwd(), 'src', 'data');\nconst eventsFilePath = path.join(dataDir, 'eventos.json');\nconst salesFilePath = path.join(dataDir, 'vendas.json');\nconst usersFilePath = path.join(dataDir, 'usuarios.json');\nconst settingsFilePath = path.join(dataDir, 'settings.json');\n\n// Helper to read JSON\nasync function readJsonFile<T>(filePath: string, defaultValue?: T): Promise<T> {\n  try {\n    await fs.access(filePath);\n  } catch (error) {\n    if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n      // If file doesn't exist, create it with default value or empty structure\n      const dataToStore = defaultValue !== undefined ? defaultValue : (filePath.endsWith('s.json') || filePath.endsWith('os.json') ? [] : {});\n      await fs.writeFile(filePath, JSON.stringify(dataToStore, null, 2), 'utf-8');\n      return dataToStore as T;\n    }\n    console.error(`Error accessing file ${filePath}:`, error);\n    throw error; // Re-throw other errors\n  }\n  // File exists, proceed to read and parse\n  try {\n    const jsonData = await fs.readFile(filePath, 'utf-8');\n    return JSON.parse(jsonData) as T;\n  } catch (error) {\n    console.error(`Error reading or parsing JSON from ${filePath}:`, error);\n    // Fallback to default value if provided on read/parse error\n    if (defaultValue !== undefined) return defaultValue;\n    // Specific fallback for list-like files if no default is provided\n    if (filePath.endsWith('s.json') || filePath.endsWith('os.json')) { \n      return [] as T; // Treat as empty list on error if it's a list file\n    }\n    throw error; // Re-throw other errors\n  }\n}\n\n// Helper to write JSON\nasync function writeJsonFile<T>(filePath: string, data: T): Promise<void> {\n  try {\n    const jsonData = JSON.stringify(data, null, 2);\n    await fs.writeFile(filePath, jsonData, 'utf-8');\n  } catch (error) {\n    console.error(`Error writing JSON to ${filePath}:`, error);\n    throw error;\n  }\n}\n\n// Settings functions\nexport async function getSettings(): Promise<SettingsData> {\n  return readJsonFile<SettingsData>(settingsFilePath, { mercadoPagoAccessToken: '' });\n}\n\nexport async function updateSettings(newSettings: Partial<SettingsData>): Promise<SettingsData> {\n  const currentSettings = await getSettings();\n  const updatedSettings = { ...currentSettings, ...newSettings };\n  await writeJsonFile(settingsFilePath, updatedSettings);\n  return updatedSettings;\n}\n\n\n// Event functions\nexport async function getEvents(): Promise<EventData[]> {\n  return readJsonFile<EventData[]>(eventsFilePath, []);\n}\n\nexport async function getEventById(id: string): Promise<EventData | undefined> {\n  const events = await getEvents();\n  return events.find(event => event.id === id);\n}\n\nexport async function getEventsByOrganizerId(organizerId: string): Promise<EventData[]> {\n  const events = await getEvents();\n  return events.filter(event => event.organizer_id === organizerId);\n}\n\nexport async function addEvent(eventDetails: EventCreationData, organizerId: string): Promise<EventData> {\n  const events = await getEvents();\n  \n  const newEvent: EventData = {\n    id: `evt-${uuidv4()}`,\n    organizer_id: organizerId,\n    ...eventDetails, \n    quantidade_disponivel: eventDetails.quantidade_total,\n    imagem_url: eventDetails.imagem_url || undefined,\n    next_sale_reference_number: 1, // Initialize counter\n  };\n  events.push(newEvent);\n  await writeJsonFile(eventsFilePath, events);\n  return newEvent;\n}\n\nexport async function updateEventSaleReferenceCounter(eventId: string, newCounterValue: number): Promise<boolean> {\n    const events = await getEvents();\n    const eventIndex = events.findIndex(event => event.id === eventId);\n\n    if (eventIndex === -1) {\n        console.error(`Event with ID ${eventId} not found for counter update.`);\n        return false;\n    }\n    events[eventIndex].next_sale_reference_number = newCounterValue;\n    await writeJsonFile(eventsFilePath, events);\n    console.log(`Event ${eventId} sale reference counter updated to ${newCounterValue}`);\n    return true;\n}\n\n\nexport async function updateEvent(eventId: string, updates: EventCreationData, currentOrganizerId: string): Promise<EventData | null> {\n  const events = await getEvents();\n  const eventIndex = events.findIndex(event => event.id === eventId);\n\n  if (eventIndex === -1) {\n    console.error(`Event with ID ${eventId} not found for update.`);\n    return null; \n  }\n\n  const currentEvent = events[eventIndex];\n\n  if (currentEvent.organizer_id !== currentOrganizerId) {\n    console.error(`Organizer ${currentOrganizerId} does not have permission to update event ${eventId}.`);\n    return null; \n  }\n\n  const ticketsSold = currentEvent.quantidade_total - currentEvent.quantidade_disponivel;\n\n  if (updates.quantidade_total < ticketsSold) {\n    console.error(`Cannot update event ${eventId}: new total quantity (${updates.quantidade_total}) is less than tickets already sold (${ticketsSold}).`);\n    return null; \n  }\n  \n  const newQuantidadeDisponivel = updates.quantidade_total - ticketsSold;\n\n  const updatedEvent: EventData = {\n    ...currentEvent, \n    ...updates,\n    quantidade_disponivel: newQuantidadeDisponivel,\n    imagem_url: updates.imagem_url || currentEvent.imagem_url, // Preserve existing image if not updated\n    next_sale_reference_number: currentEvent.next_sale_reference_number || 1, // Preserve counter or initialize\n  };\n\n  events[eventIndex] = updatedEvent;\n  await writeJsonFile(eventsFilePath, events);\n  return updatedEvent;\n}\n\n\nexport async function deleteEventAndSalesById(eventId: string): Promise<{success: boolean; message?: string}> {\n  try {\n    let events = await getEvents();\n    const eventExists = events.some(event => event.id === eventId);\n    if (!eventExists) {\n      return { success: false, message: 'Evento não encontrado.' };\n    }\n    events = events.filter(event => event.id !== eventId);\n    await writeJsonFile(eventsFilePath, events);\n\n    let sales = await getAllSales();\n    sales = sales.filter(sale => sale.evento_id !== eventId);\n    await writeJsonFile(salesFilePath, sales);\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Error deleting event and associated sales:', error);\n    return { success: false, message: 'Erro ao excluir evento e vendas associadas.' };\n  }\n}\n\n\n// Sale functions\nexport async function getAllSales(): Promise<SaleData[]> {\n  return readJsonFile<SaleData[]>(salesFilePath, []);\n}\n\nexport async function getSaleById(id: string): Promise<SaleData | undefined> {\n  const sales = await getAllSales();\n  return sales.find(sale => sale.id === id);\n}\n\nexport async function getSaleByMercadoPagoExternalReference(mpExternalRef: string): Promise<SaleData | undefined> {\n  const sales = await getAllSales();\n  return sales.find(sale => sale.mercado_pago_external_reference === mpExternalRef);\n}\n\n\nexport async function addSale(saleData: NewSaleDataInternal): Promise<SaleData> {\n  const sales = await getAllSales();\n  const newSale: SaleData = {\n    id: `sale-${uuidv4().substring(0, 12)}`, // Shortened internal TrinkaPass Sale ID\n    ...saleData,\n    // mercado_pago_external_reference is already part of saleData from initiatePurchaseAction\n  };\n  sales.push(newSale);\n  await writeJsonFile(salesFilePath, sales);\n  return newSale;\n}\n\nexport async function updateSale(saleId: string, updates: Partial<Omit<SaleData, 'id' | 'evento_id' | 'nome_comprador' | 'email_comprador' | 'whatsapp' | 'quantidade' | 'preco_ingresso_unitario' | 'taxa_servico_unitaria' | 'valor_total_item' | 'valor_total_compra' | 'data_compra' | 'pix_copia_cola_mp' | 'mercado_pago_external_reference' >>): Promise<SaleData | null> {\n  const sales = await getAllSales();\n  const saleIndex = sales.findIndex(s => s.id === saleId);\n  if (saleIndex === -1) {\n    console.error(`Sale with ID ${saleId} not found for update.`);\n    return null;\n  }\n  sales[saleIndex] = { ...sales[saleIndex], ...updates };\n  await writeJsonFile(salesFilePath, sales);\n  return sales[saleIndex];\n}\n\n\nexport async function getSalesByEventId(eventId: string): Promise<SaleData[]> {\n  const sales = await getAllSales();\n  return sales.filter(sale => sale.evento_id === eventId);\n}\n\n\nexport async function updateEventStock(eventId: string, quantityChange: number, newAvailableQuantity?: number): Promise<boolean> {\n  const events = await getEvents(); \n  const eventIndex = events.findIndex(event => event.id === eventId);\n  if (eventIndex === -1) {\n    console.error(`Event with ID ${eventId} not found for stock update.`);\n    return false;\n  }\n\n  const currentEvent = events[eventIndex];\n\n  if (newAvailableQuantity !== undefined) {\n    if (newAvailableQuantity < 0 || newAvailableQuantity > currentEvent.quantidade_total) {\n      console.warn(`Invalid newAvailableQuantity ${newAvailableQuantity} for event ${eventId}. Max total: ${currentEvent.quantidade_total}.`);\n      return false;\n    }\n    currentEvent.quantidade_disponivel = newAvailableQuantity;\n  } else {\n    const proposedAvailable = currentEvent.quantidade_disponivel - quantityChange;\n    if (proposedAvailable < 0) {\n      console.warn(`Not enough stock for event ID ${eventId}. Available: ${currentEvent.quantidade_disponivel}, Requested change: ${quantityChange}`);\n      return false;\n    }\n    if (proposedAvailable > currentEvent.quantidade_total) {\n      console.warn(`Proposed available stock ${proposedAvailable} exceeds total quantity ${currentEvent.quantidade_total} for event ${eventId}. Capping at total.`);\n      currentEvent.quantidade_disponivel = currentEvent.quantidade_total;\n    } else {\n      currentEvent.quantidade_disponivel = proposedAvailable;\n    }\n  }\n  \n  events[eventIndex] = currentEvent;\n  await writeJsonFile(eventsFilePath, events);\n  console.log(`Stock for event ${eventId} updated. New available: ${currentEvent.quantidade_disponivel}`);\n  return true;\n}\n\n\n// User functions\nexport async function getUsers(): Promise<UserData[]> {\n return readJsonFile<UserData[]>(usersFilePath, []);\n}\n\nexport async function getUserById(id: string): Promise<UserData | undefined> {\n  const users = await getUsers();\n  return users.find(user => user.id === id);\n}\n\nexport async function getUserByEmail(email: string): Promise<UserData | undefined> {\n  const users = await getUsers();\n  return users.find(user => user.email === email);\n}\n\nexport async function addUser(userData: UserData): Promise<UserData> {\n  const users = await getUsers();\n  users.push(userData);\n  await writeJsonFile(usersFilePath, users);\n  return userData;\n}\n\nexport async function updateUser(userId: string, updates: Partial<Omit<UserData, 'id' | 'tipo'>>): Promise<UserData | null> {\n  const users = await getUsers();\n  const userIndex = users.findIndex(user => user.id === userId);\n\n  if (userIndex === -1) {\n    console.error(`User with ID ${userId} not found for update.`);\n    return null;\n  }\n\n  const updatedUser: UserData = { ...users[userIndex] };\n\n  if (updates.nome !== undefined) updatedUser.nome = updates.nome;\n  if (updates.email !== undefined) updatedUser.email = updates.email;\n  if (updates.whatsapp !== undefined) updatedUser.whatsapp = updates.whatsapp;\n  if (updates.password_hash !== undefined) updatedUser.password_hash = updates.password_hash;\n  \n  // Add updates for PIX key and ID photo\n  if (updates.pix_key_type !== undefined) {\n    updatedUser.pix_key_type = updates.pix_key_type === '' ? undefined : updates.pix_key_type;\n  }\n  if (updates.pix_key !== undefined) {\n     updatedUser.pix_key = updates.pix_key === '' ? undefined : updates.pix_key;\n  }\n  if (updates.id_photo_data_uri !== undefined) {\n    updatedUser.id_photo_data_uri = updates.id_photo_data_uri === '' ? undefined : updates.id_photo_data_uri;\n  }\n\n  users[userIndex] = updatedUser;\n  await writeJsonFile(usersFilePath, users);\n  return updatedUser;\n}\n\nexport async function deleteUserById(userId: string): Promise<{success: boolean; message?: string}> {\n  try {\n    let users = await getUsers();\n    const userExists = users.some(user => user.id === userId);\n    if (!userExists) {\n      return { success: false, message: 'Usuário não encontrado.' };\n    }\n    users = users.filter(user => user.id !== userId);\n    await writeJsonFile(usersFilePath, users);\n    return { success: true };\n  } catch (error) {\n    console.error('Error deleting user:', error);\n    return { success: false, message: 'Erro ao excluir usuário.' };\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/actions/auth-actions.ts"],"sourcesContent":["// src/app/actions/auth-actions.ts\n'use server';\n\nimport { getUserByEmail, addUser } from '@/lib/data-service';\nimport type { UserData, OrganizerSafeData, OrganizerRegistrationData } from '@/lib/types';\nimport { v4 as uuidv4 } from 'uuid';\n\ninterface UnifiedAuthResult {\n  success: boolean;\n  message: string;\n  user?: OrganizerSafeData; // OrganizerSafeData is Omit<UserData, 'password_hash'>\n  userType?: 'admin' | 'organizer';\n}\n\nexport async function unifiedLoginAction(credentials: { email: string; password: string }): Promise<UnifiedAuthResult> {\n  try {\n    const user = await getUserByEmail(credentials.email);\n\n    if (!user) {\n      return { success: false, message: 'Usuário não encontrado.' };\n    }\n\n    // Plain text password comparison (NEVER use in production)\n    const passwordMatch = user.password_hash === credentials.password;\n\n    if (!passwordMatch) {\n      return { success: false, message: 'Senha incorreta.' };\n    }\n\n    if (user.tipo !== 'admin' && user.tipo !== 'organizer') {\n      // This also covers cases where 'tipo' might be 'buyer' or undefined\n      return { success: false, message: 'Acesso negado. Tipo de usuário não permitido para login nesta área.' };\n    }\n    \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const { password_hash, ...userWithoutPassword } = user;\n    return { \n      success: true, \n      message: 'Login bem-sucedido!', \n      user: userWithoutPassword, \n      userType: user.tipo as 'admin' | 'organizer' // Safe to cast after validation\n    };\n\n  } catch (error) {\n    console.error('Unified login error:', error);\n    return { success: false, message: 'Ocorreu um erro durante o login. Tente novamente.' };\n  }\n}\n\n\nexport async function organizerRegisterAction(data: OrganizerRegistrationData): Promise<UnifiedAuthResult> {\n  try {\n    const existingUser = await getUserByEmail(data.email);\n    if (existingUser) {\n      return { success: false, message: 'Este e-mail já está cadastrado.' };\n    }\n\n    const hashedPassword = data.password_hash; \n\n    const newUser: UserData = {\n      id: `org-${uuidv4()}`, \n      nome: data.nome,\n      email: data.email,\n      password_hash: hashedPassword,\n      tipo: 'organizer',\n      whatsapp: data.whatsapp,\n    };\n\n    const addedUser = await addUser(newUser);\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const { password_hash, ...userWithoutPassword } = addedUser;\n\n    return { \n        success: true, \n        message: 'Cadastro realizado com sucesso!', \n        user: userWithoutPassword,\n        userType: 'organizer' // Explicitly set userType for registration\n    };\n\n  } catch (error)\n {\n    console.error('Organizer registration error:', error);\n    return { success: false, message: 'Ocorreu um erro durante o cadastro. Tente novamente.' };\n  }\n}\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;;;AAGlC;AAEA;;;;;;AASO,eAAe,uCAAgB,GAAhB,mBAAmB,WAAgD;IACvF,IAAI;QACF,MAAM,OAAO,MAAM,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE,YAAY,KAAK;QAEnD,IAAI,CAAC,MAAM;YACT,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAA0B;QAC9D;QAEA,2DAA2D;QAC3D,MAAM,gBAAgB,KAAK,aAAa,KAAK,YAAY,QAAQ;QAEjE,IAAI,CAAC,eAAe;YAClB,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAmB;QACvD;QAEA,IAAI,KAAK,IAAI,KAAK,WAAW,KAAK,IAAI,KAAK,aAAa;YACtD,oEAAoE;YACpE,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAsE;QAC1G;QAEA,6DAA6D;QAC7D,MAAM,EAAE,aAAa,EAAE,GAAG,qBAAqB,GAAG;QAClD,OAAO;YACL,SAAS;YACT,SAAS;YACT,MAAM;YACN,UAAU,KAAK,IAAI;QACrB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS;YAAO,SAAS;QAAoD;IACxF;AACF;AAGO,eAAe,uCAAqB,GAArB,wBAAwB,IAA+B;IAC3E,IAAI;QACF,MAAM,eAAe,MAAM,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE,KAAK,KAAK;QACpD,IAAI,cAAc;YAChB,OAAO;gBAAE,SAAS;gBAAO,SAAS;YAAkC;QACtE;QAEA,MAAM,iBAAiB,KAAK,aAAa;QAEzC,MAAM,UAAoB;YACxB,IAAI,CAAC,IAAI,EAAE,CAAA,GAAA,kLAAA,CAAA,KAAM,AAAD,KAAK;YACrB,MAAM,KAAK,IAAI;YACf,OAAO,KAAK,KAAK;YACjB,eAAe;YACf,MAAM;YACN,UAAU,KAAK,QAAQ;QACzB;QAEA,MAAM,YAAY,MAAM,CAAA,GAAA,6HAAA,CAAA,UAAO,AAAD,EAAE;QAChC,6DAA6D;QAC7D,MAAM,EAAE,aAAa,EAAE,GAAG,qBAAqB,GAAG;QAElD,OAAO;YACH,SAAS;YACT,SAAS;YACT,MAAM;YACN,UAAU,YAAY,2CAA2C;QACrE;IAEF,EAAE,OAAO,OACV;QACG,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;YAAE,SAAS;YAAO,SAAS;QAAuD;IAC3F;AACF;;;IAtEsB;IAoCA;;AApCA,+OAAA;AAoCA,+OAAA","debugId":null}},
    {"offset": {"line": 503, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 557, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/login/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/login/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/login/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA0R,GACvT,wDACA","debugId":null}},
    {"offset": {"line": 571, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/login/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/login/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/login/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAsQ,GACnS,oCACA","debugId":null}},
    {"offset": {"line": 585, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}